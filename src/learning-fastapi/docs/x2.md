## FastAPI 路径参数详解：从入门到精通

FastAPI 允许你像使用 Python 格式化字符串一样，在路径中声明“参数”或“变量”，从而构建灵活的 API 接口。

**1. 基础用法**

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(item_id: str):
    return {"item_id": item_id}
```

在这个例子中，`/items/{item_id}` 定义了一个路径，其中 `item_id` 是一个路径参数。当访问 `http://127.0.0.1:8000/items/foo` 时，`read_item` 函数会被调用，`item_id` 的值会被设置为 "foo"，最终返回 `{"item_id":"foo"}`。

**2. 类型注解**

你可以使用 Python 的类型注解来指定路径参数的类型，例如：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/{item_id}")
async def read_item(item_id: int):
    return {"item_id": item_id}
```

这里，`item_id: int` 表明 `item_id` 应该是一个整数。

*   **数据转换**：当访问 `http://127.0.0.1:8000/items/3` 时，FastAPI 会自动将字符串 "3" 转换为整数 3，并传递给 `read_item` 函数。
*   **数据校验**：如果访问 `http://127.0.0.1:8000/items/foo`，FastAPI 会返回一个 HTTP 错误，因为 "foo" 无法转换为整数。 错误信息会明确指出校验失败的位置和原因，例如 "Input should be a valid integer, unable to parse string as an integer"。

**3. 实际应用案例：商品 ID 查询**

假设你正在开发一个电商网站的 API，需要根据商品 ID 查询商品信息。你可以这样定义 API 接口：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/products/{product_id}")
async def get_product(product_id: int):
    # 假设这里是从数据库查询商品信息的代码
    product = {"id": product_id, "name": f"Product {product_id}", "price": 99.99}
    return product
```

访问 `http://127.0.0.1:8000/products/123` 将返回：

```json
{
  "id": 123,
  "name": "Product 123",
  "price": 99.99
}
```

**4. 路径顺序**

当定义多个路径时，路径的顺序很重要。FastAPI 会按照定义的顺序依次匹配路径。例如：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/me")
async def read_user_me():
    return {"user_id": "当前用户"}

@app.get("/users/{user_id}")
async def read_user(user_id: str):
    return {"user_id": user_id}
```

`/users/me` 必须在 `/users/{user_id}` 之前定义。否则，访问 `/users/me` 时，会被错误地匹配到 `/users/{user_id}`，`user_id` 的值会被解析为 "me"。

**5. 预定义值 (枚举)**

如果希望路径参数只能取预定义的值，可以使用 Python 的 `Enum`。

```python
from enum import Enum
from fastapi import FastAPI

class Color(str, Enum):
    red = "red"
    green = "green"
    blue = "blue"

app = FastAPI()

@app.get("/colors/{color_name}")
async def get_color(color_name: Color):
    return {"color_name": color_name, "hex_value": color_name.value}
```

在这个例子中，`color_name` 只能是 "red", "green" 或 "blue"。

*   访问 `http://127.0.0.1:8000/colors/red` 将返回 `{"color_name": "red", "hex_value": "red"}`。
*   如果访问 `http://127.0.0.1:8000/colors/yellow`，FastAPI 会返回一个校验错误。

**6. 包含路径的参数**

如果路径参数需要包含完整的路径，可以使用 Starlette 提供的 `:path` 转换器。

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/files/{file_path:path}")
async def read_file(file_path: str):
    return {"file_path": file_path}
```

访问 `http://127.0.0.1:8000/files/home/user/documents/report.pdf` 将返回：

```json
{
  "file_path": "home/user/documents/report.pdf"
}
```

**7. 总结**

FastAPI 的路径参数功能强大且易于使用。通过类型注解和枚举，你可以轻松地实现数据转换、数据校验和 API 文档生成。

**关键优势**

*   **代码更简洁**：类型声明和校验合二为一。
*   **减少 bug**：在开发阶段就能发现类型错误。
*   **自动生成文档**：Swagger UI 和 ReDoc 提供交互式 API 文档。
*   **性能卓越**：基于 Starlette 和 Pydantic，性能有保障。